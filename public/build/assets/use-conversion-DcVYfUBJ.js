import{r as t}from"./app-DajP5S0m.js";const S=1e3;function y(){const[h,u]=t.useState(null),[g,o]=t.useState(!1),[m,i]=t.useState(0),[b,c]=t.useState(null),l=t.useRef(null),r=t.useCallback(()=>{l.current&&(clearInterval(l.current),l.current=null)},[]),d=t.useCallback(async n=>{try{const s=await fetch(`/api/optiseo/batches/${n}`,{credentials:"include",headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(!s.ok)throw new Error("Erreur lors de la récupération du statut");return(await s.json()).batch}catch{return null}},[]),p=t.useCallback(n=>{r();const s=async()=>{const e=await d(n);e&&(u(e),i(e.progress_percentage),(e.is_completed||e.status==="failed")&&(r(),o(!1),e.status==="failed"&&c("La conversion a échoué")))};s(),l.current=setInterval(s,S)},[d,r]),C=t.useCallback(async(n,s,e)=>{o(!0),c(null),i(0);try{const a=await fetch("/api/optiseo/images/convert",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({batch_id:n,...s,keywords:e})});if(!a.ok){const w=await a.json();throw new Error(w.message||"Erreur lors du démarrage de la conversion")}const f=await a.json();u(f.batch),p(n)}catch(a){const f=a instanceof Error?a.message:"Erreur inconnue";throw c(f),o(!1),a}},[p]),E=t.useCallback(()=>{r(),u(null),o(!1),i(0),c(null)},[r]);return t.useEffect(()=>()=>{r()},[r]),{batch:h,isConverting:g,progress:m,error:b,startConversion:C,pollProgress:p,stopPolling:r,reset:E}}export{y as u};
